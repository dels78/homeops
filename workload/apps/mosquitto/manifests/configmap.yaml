---
apiVersion: v1
kind: ConfigMap
metadata:
  name: mosquitto-config
  namespace: home-automation
  labels:
    app.kubernetes.io/name: mosquitto
    app.kubernetes.io/instance: mosquitto
data:
  mosquitto.conf: |
    # Mosquitto configuration for Home Assistant and Ring-MQTT
    listener 1883
    protocol mqtt

    listener 9001
    protocol websockets

    # Allow anonymous connections (internal cluster only)
    allow_anonymous true

    # Persistence
    persistence true
    persistence_location /mosquitto/data/

    # Logging
    log_dest stdout
    log_type error
    log_type warning
    log_type notice
    log_type information

    # Connection settings
    max_keepalive 60
    max_connections -1
